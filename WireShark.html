<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Wireshark Basics Training</title>

    <style>
        /* General Styling */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 1.5rem 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            position: relative;
            z-index: 10; /* Ensure header is on top */
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
        }

        .container {
            display: flex;
            flex-grow: 1;
            overflow: hidden; /* Prevent content overflow */
        }

        /* Control Panel / Info Area */
        .control-panel {
            width: 350px;
            background-color: #ffffff;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            overflow-y: auto; /* Scroll for long content */
            flex-shrink: 0; /* Don't shrink */
        }

        .control-panel h2 {
            color: #34495e;
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .control-panel p, .control-panel ul {
            font-size: 0.95em;
            margin-bottom: 10px;
        }

        .control-panel ul {
            padding-left: 20px;
        }

        .control-panel button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 15px;
            margin-right: 10px;
            transition: background-color 0.2s ease;
        }

        .control-panel button:hover {
            background-color: #2980b9;
        }

        .control-panel button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .control-panel button.reset-btn {
            background-color: #e74c3c;
        }
        .control-panel button.reset-btn:hover {
            background-color: #c0392b;
        }

        /* Network Animation Area */
        .network-animation-area {
            flex-grow: 1;
            background-color: #e6e9ed;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* Clip packet movement if it goes out */
        }

        .network-device {
            width: 80px;
            height: 80px;
            background-color: #3498db;
            border-radius: 8px;
            position: absolute;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 0.8em;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border: 2px solid transparent;
            transition: border-color 0.3s ease;
        }

        .network-device.highlight {
            border-color: #f1c40f; /* Yellow highlight */
            box-shadow: 0 0 20px rgba(241, 196, 15, 0.7);
        }

        /* Specific device positions */
        #client-host { left: 10%; top: 50%; transform: translateY(-50%); background-color: #28a745; } /* Green */
        #server-host { right: 10%; top: 50%; transform: translateY(-50%); background-color: #e67e22; } /* Orange */
        #switch-device { left: 50%; top: 50%; transform: translate(-50%, -50%); background-color: #9b59b6; width: 100px; height: 100px; } /* Purple */

        .device-label {
            position: absolute;
            color: #333;
            font-weight: bold;
            font-size: 0.9em;
            margin-top: 90px; /* Below the device */
            text-align: center;
        }
        #client-label { left: 10%; transform: translateX(-50%); }
        #server-label { right: 10%; transform: translateX(50%); }
        #switch-label { left: 50%; transform: translateX(-50%); }

        /* Promiscuous mode visual */
        #promiscuous-indicator {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #f1c40f; /* Yellow */
            border-radius: 50%;
            top: -10px; /* Position above client host */
            right: -10px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            box-shadow: 0 0 15px rgba(241, 196, 15, 0.7);
            animation: pulse 1.5s infinite alternate ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.7em;
            color: #333;
            font-weight: bold;
        }
        #promiscuous-indicator.active {
            opacity: 1;
        }
        @keyframes pulse {
            from { transform: scale(0.8); opacity: 0.6; }
            to { transform: scale(1.1); opacity: 1; }
        }

        /* Capture Filter visual */
        #capture-filter-indicator {
            position: absolute;
            left: 30%; /* Roughly between client and switch */
            top: 45%;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.75em;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            transform: rotate(-10deg);
        }
        #capture-filter-indicator.active {
            opacity: 1;
        }

        /* Packet Styling */
        #packet {
            width: 40px;
            height: 25px;
            background-color: #f1c40f; /* Yellow packet */
            border: 1px solid #c9a40c;
            border-radius: 3px;
            position: absolute;
            top: 50%;
            left: 10%; /* Start at client */
            transform: translateY(-50%);
            display: none; /* Hidden initially */
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            font-size: 0.7em;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 1.5s ease-in-out; /* Smooth movement */
        }

        /* Animation classes for packet */
        #packet.animate-to-switch {
            transform: translate(calc(50vw - 10% - 20px), -50%); /* Move from client to switch */
        }
        #packet.animate-to-server {
            transform: translate(calc(90vw - 10% - 20px), -50%); /* Move from client to server (past switch) */
        }
        #packet.animate-back-to-switch {
            transform: translate(calc(50vw - 10% - 20px), -50%); /* Move from server to switch */
        }
        #packet.animate-back-to-client {
             transform: translateY(-50%); /* Reset to client's initial Y, but X is already 10% of width */
        }


        /* OSI/TCP-IP Model Visualization */
        .model-container {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            border: 1px solid #ccc;
            background-color: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 5px;
            display: none; /* Hidden initially */
            z-index: 5; /* Below header */
        }

        .model-layer {
            padding: 8px 15px;
            border-bottom: 1px solid #eee;
            text-align: center;
            font-size: 0.9em;
            color: #555;
            transition: background-color 0.3s ease, color 0.3s ease, font-weight 0.3s ease;
        }
        .model-layer:last-child { border-bottom: none; }

        .model-layer.active {
            background-color: #3498db;
            color: white;
            font-weight: bold;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }

        .model-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }

        /* Wireshark Output Area */
        .wireshark-output {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #23272e; /* Dark background for code */
            color: #a9b7c6; /* Light text color */
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.8em;
            width: 80%;
            max-width: 700px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            display: none; /* Hidden initially */
            white-space: pre-wrap; /* Preserve whitespace and wrap */
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #555;
            z-index: 5;
        }

        .output-highlight {
            color: #f1c40f; /* Yellow highlight for active line */
            font-weight: bold;
        }

        /* Mobile Responsiveness */
        @media (max-width: 900px) {
            .container {
                flex-direction: column;
            }
            .control-panel {
                width: 100%;
                max-height: 40vh; /* Limit height on small screens */
                overflow-y: auto;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }
            .network-animation-area {
                min-height: 50vh; /* Ensure some height for animation */
                padding-top: 50px; /* Adjust for device placement */
            }
            .network-device {
                top: 20%; /* Move devices up slightly */
                transform: translateX(-50%); /* Adjust centering */
            }
            #client-host { left: 10%; }
            #server-host { right: 10%; }
            #switch-device { left: 50%; }

            #client-label { top: 30%; left: 10%; }
            #server-label { top: 30%; right: 10%; }
            #switch-label { top: 30%; left: 50%; }

            #promiscuous-indicator {
                top: 10px; right: -5px;
                width: 15px; height: 15px; font-size: 0.6em;
            }

            #capture-filter-indicator {
                top: 35%; left: 30%; font-size: 0.65em; padding: 3px 6px;
            }

            #packet {
                top: 25%;
            }
            #packet.animate-to-switch {
                transform: translate(calc(50vw - 10% - 20px), 0);
            }
            #packet.animate-to-server {
                transform: translate(calc(90vw - 10% - 20px), 0);
            }
            #packet.animate-back-to-switch {
                transform: translate(calc(50vw - 10% - 20px), 0);
            }
            #packet.animate-back-to-client {
                transform: translateY(0);
            }

            .wireshark-output {
                width: 95%;
                bottom: 10px;
                max-height: 150px;
                font-size: 0.75em;
            }
            .model-container {
                display: none !important; /* Hide model on small screens to save space */
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>' Wireshark Basics Training</h1>
    </header>

    <div class="container">
        <div class="control-panel">
            <h2 id="trainingTitle">Getting Started...</h2>
            <p id="trainingDescription">Welcome! This interactive guide will walk you through the very basics of network packet analysis with Wireshark.</p>
            <p id="currentStepInfo">Click "Next Step" to begin.</p>

            <div class="button-group">
                <button id="nextStepBtn">Next Step</button>
                <button id="resetBtn" class="reset-btn" disabled>Reset</button>
            </div>

            <div id="osiTcpIpInfo" style="margin-top: 20px;">
                <h3>Current Layer Focus</h3>
                <p>No active layer.</p>
            </div>
        </div>

        <div class="network-animation-area">
            <!-- Network Devices -->
            <div class="network-device" id="client-host">
                Client
                <div id="promiscuous-indicator">P</div> <!-- 'P' for Promiscuous -->
            </div>
            <div class="device-label" id="client-label">192.168.1.100</div>

            <div class="network-device" id="switch-device">Switch</div>
            <div class="device-label" id="switch-label">Layer 2</div>

            <div class="network-device" id="server-host">Server</div>
            <div class="device-label" id="server-label">192.168.1.1</div>

            <!-- Capture Filter visual -->
            <div id="capture-filter-indicator">BPF Filter: icmp</div>

            <!-- Packet -->
            <div id="packet">ICMP</div>

            <!-- OSI/TCP-IP Model Visual -->
            <div id="osiModelVisual" class="model-container">
                <div class="model-title">OSI Model</div>
                <div class="model-layer" id="osi-layer-7">7. Application</div>
                <div class="model-layer" id="osi-layer-6">6. Presentation</div>
                <div class="model-layer" id="osi-layer-5">5. Session</div>
                <div class="model-layer" id="osi-layer-4">4. Transport (TCP/UDP)</div>
                <div class="model-layer" id="osi-layer-3">3. Network (IP)</div>
                <div class="model-layer" id="osi-layer-2">2. Data Link (Ethernet)</div>
                <div class="model-layer" id="osi-layer-1">1. Physical</div>
            </div>

            <!-- Wireshark Output Simulation -->
            <pre id="wiresharkOutput" class="wireshark-output">
[Simulated Wireshark Packet Detail]
</pre>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const trainingTitle = document.getElementById('trainingTitle');
            const trainingDescription = document.getElementById('trainingDescription');
            const currentStepInfo = document.getElementById('currentStepInfo');
            const nextStepBtn = document.getElementById('nextStepBtn');
            const resetBtn = document.getElementById('resetBtn');
            const osiTcpIpInfo = document.getElementById('osiTcpIpInfo');

            const clientHost = document.getElementById('client-host');
            const serverHost = document.getElementById('server-host');
            const switchDevice = document.getElementById('switch-device');
            const packet = document.getElementById('packet');

            const promiscuousIndicator = document.getElementById('promiscuous-indicator');
            const captureFilterIndicator = document.getElementById('capture-filter-indicator');


            const osiModelVisual = document.getElementById('osiModelVisual');
            const osiLayers = {
                'Application': document.getElementById('osi-layer-7'),
                'Presentation': document.getElementById('osi-layer-6'),
                'Session': document.getElementById('osi-layer-5'),
                'Transport': document.getElementById('osi-layer-4'),
                'Network': document.getElementById('osi-layer-3'),
                'Data Link': document.getElementById('osi-layer-2'),
                'Physical': document.getElementById('osi-layer-1')
            };

            const wiresharkOutput = document.getElementById('wiresharkOutput');

            let currentStep = 0;
            const trainingSteps = [
                {
                    title: "Welcome to Wireshark Basics!",
                    description: "Wireshark is the most popular network protocol analyzer. It lets you see what's happening on your network at a microscopic level. Let's explore how network traffic flows.",
                    action: () => {
                        resetAnimation();
                    },
                    layer: null
                },
                {
                    title: "The Network: Client, Switch, Server",
                    description: "Our simple network consists of a Client, a Switch, and a Server. We'll simulate a 'ping' (ICMP Echo Request) from the Client to the Server.",
                    action: () => {
                        clientHost.classList.add('highlight');
                    },
                    layer: null
                },
                {
                    title: "Network Interface Cards (NICs)",
                    description: "Every device connects to the network via a Network Interface Card (NIC). Normally, a NIC only processes traffic specifically addressed to it, ignoring other traffic on the wire.",
                    action: () => {
                        clientHost.classList.add('highlight');
                    },
                    layer: null
                },
                {
                    title: "Promiscuous Mode & Npcap/libcap",
                    description: "To capture *all* traffic, Wireshark puts the NIC into **Promiscuous Mode**. This is enabled by special drivers like <a href='https://nmap.org/npcap/' target='_blank'>Npcap</a> (Windows) or libcap (Linux/macOS).",
                    action: () => {
                        clientHost.classList.add('highlight');
                        promiscuousIndicator.classList.add('active');
                    },
                    layer: null
                },
                {
                    title: "Capture Filters (BPF)",
                    description: "Networks can be very noisy. Wireshark can use **Capture Filters** (Berkeley Packet Filter - BPF) to discard unwanted packets *before* they are even sent to Wireshark's memory. This saves resources.",
                    action: () => {
                        clientHost.classList.add('highlight');
                        promiscuousIndicator.classList.add('active');
                        captureFilterIndicator.classList.add('active');
                        captureFilterIndicator.innerHTML = 'BPF Filter: icmp';
                        osiTcpIpInfo.innerHTML = `<h3>Capture Filter Active</h3><p><strong>Filter:</strong> <code>icmp</code></p><p>Only ICMP packets will be captured.</p>`;
                    },
                    layer: null
                },
                {
                    title: "OSI Model: Understanding Layers",
                    description: "Now that we're ready to capture, let's review how packets are built and processed through the <a href='https://en.wikipedia.org/wiki/OSI_model' target='_blank'>OSI Model</a> layers. Wireshark dissects traffic according to these layers.",
                    action: () => {
                        clientHost.classList.add('highlight');
                        promiscuousIndicator.classList.add('active');
                        captureFilterIndicator.classList.add('active');
                        osiModelVisual.style.display = 'flex';
                        highlightOsiLayer('Application', "The user application (like a ping utility) initiates communication here.");
                    },
                    layer: 'Application'
                },
                {
                    title: "Client: Encapsulation - Network Layer (IP)",
                    description: "The Application layer hands data down. At the Network layer, the IP header is added. This includes the Source IP (Client) and Destination IP (Server).",
                    action: () => {
                        highlightOsiLayer('Network', "IP (Internet Protocol) handles logical addressing and routing.");
                        packet.style.display = 'block';
                        packet.textContent = 'IP/ICMP';
                    },
                    layer: 'Network'
                },
                {
                    title: "Client: Encapsulation - Data Link Layer (Ethernet)",
                    description: "Next, the Data Link layer adds the Ethernet header, which contains the Source MAC (Client's NIC) and Destination MAC (the next hop, the Switch's MAC).",
                    action: () => {
                        highlightOsiLayer('Data Link', "Ethernet handles physical addressing (MAC) and framing.");
                    },
                    layer: 'Data Link'
                },
                {
                    title: "Client: Encapsulation - Physical Layer",
                    description: "Finally, the packet is converted into electrical signals (or light, or radio waves) and sent out onto the physical medium.",
                    action: () => {
                        highlightOsiLayer('Physical', "The raw bits are transmitted over the wire.");
                    },
                    layer: 'Physical'
                },
                {
                    title: "Packet Transmits to Switch (Captured!)",
                    description: "The packet leaves the Client and travels to the Switch. Our Wireshark capture (with the 'icmp' filter) would now record this packet!",
                    action: () => {
                        packet.style.left = '10%'; // Ensure starting position for animation
                        packet.classList.add('animate-to-switch');
                        clientHost.classList.remove('highlight');
                        switchDevice.classList.add('highlight');
                        osiModelVisual.style.display = 'none';
                        wiresharkOutput.style.display = 'block';
                        updateWiresharkOutput(1, "Client sending ICMP Echo Request to Server:",
                            "Frame 1: 68 bytes on wire (544 bits), 68 bytes captured (544 bits)",
                            "Ethernet II, Src: 00:11:22:33:44:55 (Client), Dst: 00:0a:0b:0c:0d:0e (Switch)",
                            "Internet Protocol Version 4, Src: 192.168.1.100 (Client), Dst: 192.168.1.1 (Server)",
                            "Internet Control Message Protocol (Echo (ping) request)"
                        );
                    },
                    layer: null
                },
                {
                    title: "Switch: Decapsulation & Forwarding (Data Link Layer)",
                    description: "The Switch receives the packet. Being a Layer 2 device, it inspects the Data Link (Ethernet) header to determine the destination MAC address and forwards the packet to the correct port.",
                    action: () => {
                        switchDevice.classList.add('highlight');
                        clientHost.classList.remove('highlight');
                        highlightOsiLayer('Data Link', "The Switch examines the destination MAC address.");
                        osiModelVisual.style.display = 'flex';
                        updateWiresharkOutput(2, "Switch receiving, processing, and forwarding:",
                            "Frame 1: 68 bytes on wire (544 bits), 68 bytes captured (544 bits)",
                            "<span class='output-highlight'>Ethernet II, Src: 00:11:22:33:44:55 (Client), Dst: 00:0a:0b:0c:0d:0e (Switch)</span>",
                            "Internet Protocol Version 4, Src: 192.168.1.100 (Client), Dst: 192.168.1.1 (Server)",
                            "Internet Control Message Protocol (Echo (ping) request)"
                        );
                    },
                    layer: 'Data Link'
                },
                {
                    title: "Packet Transmits to Server",
                    description: "The Switch forwards the packet directly to the Server. The packet is now approaching its final destination.",
                    action: () => {
                        packet.classList.remove('animate-to-switch');
                        packet.classList.add('animate-to-server');
                        switchDevice.classList.remove('highlight');
                        serverHost.classList.add('highlight');
                        osiModelVisual.style.display = 'none';
                        updateWiresharkOutput(1, "Packet forwarded to Server:",
                            "Frame 1: 68 bytes on wire (544 bits), 68 bytes captured (544 bits)",
                            "Ethernet II, Src: 00:11:22:33:44:55 (Client), Dst: 00:1a:2b:3c:4d:5e (Server)", // Switch rewrites Dst MAC
                            "Internet Protocol Version 4, Src: 192.168.1.100 (Client), Dst: 192.168.1.1 (Server)",
                            "Internet Control Message Protocol (Echo (ping) request)"
                        );
                    },
                    layer: null
                },
                {
                    title: "Server: Decapsulation - Data Link Layer",
                    description: "The Server receives the packet. It inspects the Data Link header to ensure it's addressed to its own MAC address.",
                    action: () => {
                        serverHost.classList.add('highlight');
                        highlightOsiLayer('Data Link', "The Server verifies the destination MAC address.");
                        osiModelVisual.style.display = 'flex';
                        updateWiresharkOutput(2, "Server receiving packet:",
                            "Frame 1: 68 bytes on wire (544 bits), 68 bytes captured (544 bits)",
                            "<span class='output-highlight'>Ethernet II, Src: 00:11:22:33:44:55 (Client), Dst: 00:1a:2b:3c:4d:5e (Server)</span>",
                            "Internet Protocol Version 4, Src: 192.168.1.100 (Client), Dst: 192.168.1.1 (Server)",
                            "Internet Control Message Protocol (Echo (ping) request)"
                        );
                    },
                    layer: 'Data Link'
                },
                {
                    title: "Server: Decapsulation - Network Layer",
                    description: "After the Data Link header is processed, the Network layer inspects the IP header to ensure the packet is addressed to the Server's IP address.",
                    action: () => {
                        highlightOsiLayer('Network', "The Server verifies the destination IP address.");
                        updateWiresharkOutput(3, "Server processing IP header:",
                            "Frame 1: 68 bytes on wire (544 bits), 68 bytes captured (544 bits)",
                            "Ethernet II, Src: 00:11:22:33:44:55 (Client), Dst: 00:1a:2b:3c:4d:5e (Server)",
                            "Internet Protocol Version 4, Src: 192.168.1.100 (Client), Dst: 192.168.1.1 (Server)",
                            "<span class='output-highlight'>Internet Protocol Version 4, Src: 192.168.1.100 (Client), Dst: 192.168.1.1 (Server)</span>",
                            "Internet Control Message Protocol (Echo (ping) request)"
                        );
                    },
                    layer: 'Network'
                },
                {
                    title: "Server: Decapsulation - Application Layer",
                    description: "Finally, the ICMP Echo Request reaches the Application layer. The Server processes the request and prepares an ICMP Echo Reply.",
                    action: () => {
                        highlightOsiLayer('Application', "The ICMP application processes the request.");
                        packet.textContent = 'ICMP Reply';
                        updateWiresharkOutput(4, "Server processing and preparing reply:",
                            "Frame 1: 68 bytes on wire (544 bits), 68 bytes captured (544 bits)",
                            "Ethernet II, Src: 00:11:22:33:44:55 (Client), Dst: 00:1a:2b:3c:4d:5e (Server)",
                            "Internet Protocol Version 4, Src: 192.168.1.100 (Client), Dst: 192.168.1.1 (Server)",
                            "<span class='output-highlight'>Internet Control Message Protocol (Echo (ping) request)</span>"
                        );
                    },
                    layer: 'Application'
                },
                {
                    title: "Server: Encapsulation & Reply - Back to Client!",
                    description: "The Server now encapsulates an ICMP Echo Reply and sends it back to the Client, following the same layered process in reverse. This reply would also be captured by Wireshark.",
                    action: () => {
                        osiModelVisual.style.display = 'none';
                        packet.classList.remove('animate-to-server');
                        packet.classList.add('animate-back-to-switch'); // Packet moves from server to switch (visually)
                        serverHost.classList.remove('highlight');
                        switchDevice.classList.add('highlight');
                        updateWiresharkOutput(1, "Server sending ICMP Echo Reply to Client:",
                            "Frame 2: 68 bytes on wire (544 bits), 68 bytes captured (544 bits)",
                            "Ethernet II, Src: 00:1a:2b:3c:4d:5e (Server), Dst: 00:0a:0b:0c:0d:0e (Switch)",
                            "Internet Protocol Version 4, Src: 192.168.1.1 (Server), Dst: 192.168.1.100 (Client)",
                            "Internet Control Message Protocol (Echo (ping) reply)"
                        );
                    },
                    layer: null
                },
                {
                    title: "Reply Transmits to Client (Captured!)",
                    description: "The Switch forwards the reply from the Server back to the Client. Wireshark captures this incoming reply.",
                    action: () => {
                        packet.classList.remove('animate-back-to-switch');
                        packet.classList.add('animate-back-to-client'); // Packet moves from switch to client
                        switchDevice.classList.remove('highlight');
                        clientHost.classList.add('highlight');
                        updateWiresharkOutput(1, "Switch forwarding reply to Client:",
                            "Frame 2: 68 bytes on wire (544 bits), 68 bytes captured (544 bits)",
                            "Ethernet II, Src: 00:1a:2b:3c:4d:5e (Server), Dst: 00:11:22:33:44:55 (Client)",
                            "Internet Protocol Version 4, Src: 192.168.1.1 (Server), Dst: 192.168.1.100 (Client)",
                            "Internet Control Message Protocol (Echo (ping) reply)"
                        );
                    },
                    layer: null
                },
                {
                    title: "Client: Decapsulation of Reply",
                    description: "The Client receives the reply, decapsulates it layer by layer, and finally processes the ICMP Echo Reply at the Application layer.",
                    action: () => {
                        osiModelVisual.style.display = 'flex';
                        highlightOsiLayer('Application', "The Client's ping utility receives the reply.");
                        updateWiresharkOutput(4, "Client receiving and processing reply:",
                            "Frame 2: 68 bytes on wire (544 bits), 68 bytes captured (544 bits)",
                            "Ethernet II, Src: 00:1a:2b:3c:4d:5e (Server), Dst: 00:11:22:33:44:55 (Client)",
                            "Internet Protocol Version 4, Src: 192.168.1.1 (Server), Dst: 192.168.1.100 (Client)",
                            "<span class='output-highlight'>Internet Control Message Protocol (Echo (ping) reply)</span>"
                        );
                    },
                    layer: 'Application'
                },
                {
                    title: "Training Complete!",
                    description: "You've witnessed a basic network communication from a Wireshark perspective, including the capture process! This layered approach is key to effective packet analysis. Click Reset to restart.",
                    action: () => {
                        resetAnimation();
                        nextStepBtn.disabled = true;
                        resetBtn.disabled = false;
                    },
                    layer: null
                }
            ];

            function updateUI() {
                const step = trainingSteps[currentStep];
                trainingTitle.textContent = step.title;
                trainingDescription.innerHTML = step.description; // Use innerHTML for potential links
                currentStepInfo.textContent = `Step ${currentStep + 1} of ${trainingSteps.length}`;
                step.action();

                if (currentStep === trainingSteps.length - 1) {
                    nextStepBtn.disabled = true;
                    resetBtn.disabled = false;
                } else {
                    nextStepBtn.disabled = false;
                    resetBtn.disabled = false;
                }
            }

            function highlightOsiLayer(layerName, infoText) {
                // Clear all highlights first
                for (const key in osiLayers) {
                    osiLayers[key].classList.remove('active');
                }
                // Highlight the specific layer
                if (osiLayers[layerName]) {
                    osiLayers[layerName].classList.add('active');
                    osiTcpIpInfo.innerHTML = `<h3>Current Layer Focus</h3><p><strong>Layer:</strong> ${layerName}</p><p>${infoText}</p>`;
                } else {
                     osiTcpIpInfo.innerHTML = `<h3>Current Layer Focus</h3><p>No active layer focus.</p>`;
                }
            }

            function updateWiresharkOutput(highlightLine, ...lines) {
                const formattedOutput = lines.map((line, index) => {
                    return index === (highlightLine -1) ? `<span class="output-highlight">${line}</span>` : line;
                }).join('\n');
                wiresharkOutput.innerHTML = formattedOutput;
                wiresharkOutput.style.display = 'block'; // Ensure it's visible when content is there
            }


            function resetAnimation() {
                packet.style.display = 'none';
                packet.className = ''; // Remove all animation classes
                packet.style.left = '10%'; // Reset packet position
                packet.textContent = 'ICMP'; // Reset packet content

                clientHost.classList.remove('highlight');
                serverHost.classList.remove('highlight');
                switchDevice.classList.remove('highlight');

                promiscuousIndicator.classList.remove('active');
                captureFilterIndicator.classList.remove('active');

                for (const key in osiLayers) {
                    osiLayers[key].classList.remove('active');
                }
                osiModelVisual.style.display = 'none';
                wiresharkOutput.style.display = 'none';
                wiresharkOutput.textContent = '[Simulated Wireshark Packet Detail]';
                osiTcpIpInfo.innerHTML = `<h3>Current Layer Focus</h3><p>No active layer focus.</p>`;
            }


            nextStepBtn.addEventListener('click', () => {
                if (currentStep < trainingSteps.length - 1) {
                    currentStep++;
                    updateUI();
                }
            });

            resetBtn.addEventListener('click', () => {
                currentStep = 0;
                updateUI();
            });

            // Initial UI setup
            updateUI();
        });
    </script>
</body>
</html>
